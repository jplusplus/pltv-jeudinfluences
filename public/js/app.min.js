var ChapterCtrl,MainCtrl,NavCtrl,SceneCtrl,app,__bind=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("spin.controller",["ngResource"]),angular.module("spin.config",["ngResource"]),angular.module("spin.directive",["ngResource"]),angular.module("spin.filter",["ngResource"]),angular.module("spin.service",["ngResource","LocalStorageModule"]),app=angular.module("spin",["ngRoute","ngResource","ngAnimate","spin.filter","spin.service","spin.directive"]),app.config(["$interpolateProvider","$routeProvider",function(a,b){return a.startSymbol("[["),a.endSymbol("]]"),b.when("/",{templateUrl:"partials/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),ChapterCtrl=function(){function a(a,b,c){var d=this;this.scope=a,this.Plot=b,this.User=c,this.scope.shouldShowChapter=function(a){return 1*a.id===d.User.chapter}}return a.$inject=["$scope","Plot","User"],a}(),MainCtrl=function(){function a(a,b,c,d){this.scope=a,this.Plot=b,this.User=c,this.Sound=d,this.scope.plot=this.Plot,this.scope.user=this.User,this.scope.sound=this.Sound}return a.$inject=["$scope","Plot","User","Sound"],a}(),NavCtrl=function(){function a(a,b){var c=this;this.scope=a,this.User=b,this.scope.volume=100*this.User.volume,this.scope.$watch("volume",function(a){return null!=a?c.User.volume=a/100:void 0})}return a.$inject=["$scope","User"],a}(),SceneCtrl=function(){function a(a,b,c){var d,e,f=this;this.scope=a,this.Plot=b,this.User=c,e=["dialogue","narrative","video","notification"],d=["dialogue","narrative","voixoff","video","notification","choice"],this.scope.shouldShowScene=function(a){return 1*a.id===f.User.scene},this.scope.shouldShowSequence=function(a){return 1*a===f.User.sequence},this.scope.shouldShowNext=function(a){return!0},this.scope.goToNextSequence=this.User.nextSequence}return a.$inject=["$scope","Plot","User"],a}(),angular.module("spin.directive").directive("screenHeight",["$window",function(a){return function(b,c,d){var e,f;return e="screenHeight resize",f=function(){return c.css("height",a.innerHeight),isNaN(d.screenHeight)?void 0:c.css("min-height",1*d.screenHeight)},f(),angular.element(a).bind(e,f),b.$on("$destroy",function(){return angular.element(a).unbind(e)})}}]),angular.module("spin.filter",[]).filter("checkmark",function(){return function(a){return a?"✓":"✘"}}),angular.module("spin.service").factory("Plot",["$http",function(a){var b;return new(b=function(){function b(){this.sequence=__bind(this.sequence,this),this.scene=__bind(this.scene,this),this.chapter=__bind(this.chapter,this);var b=this;return this.chapters=[],a.get("/api/plot").success(function(a){return b.chapters=a}),this}return b.prototype.chapter=function(a){return _.find(this.chapters||[],function(b){return 1*b.id===1*a})},b.prototype.scene=function(a,b){var c;return c=this.chapter(a)||{},_.find(c.scenes||[],function(a){return 1*a.id===1*b})},b.prototype.sequence=function(a,b,c){var d;return d=this.scene(a,b)||{sequence:[]},d.sequence[c]},b}())}]),angular.module("spin.service").factory("Sound",["User","Plot","$rootScope",function(a,b,c){var d;return new(d=function(){function d(){this.updateVolume=__bind(this.updateVolume,this),this.startSequence=__bind(this.startSequence,this),this.startScene=__bind(this.startScene,this);var d=this;c.$watch(function(){return b.chapters||a.scene},function(){return d.startScene()}),c.$watch(function(){return a.sequence},function(){return d.startSequence()}),c.$watch(function(){return a.volume},this.updateVolume)}return d.prototype.startScene=function(c,d){var e,f=this;return null==c&&(c=a.chapter),null==d&&(d=a.scene),null!=d&&b.chapters.length&&(d=b.scene(c,d),e=[d.decor[0].soundtrack],null==this.soundtrack||!angular.equals(this.soundtrack.urls(),e))?(this.soundtrack=new Howl({urls:e,loop:!0,buffer:!0,volume:0}),this.soundtrack.play(function(){return f.soundtrack.fade(0,a.volume,2e3)})):void 0},d.prototype.startSequence=function(c,d,e){var f,g=this;if(null==c&&(c=a.chapter),null==d&&(d=a.scene),null==e&&(e=a.sequence),null!=e)if(e=b.sequence(c,d,e),"voixoff"===e.type){if(f=[e.body],null==this.voicetrack||!angular.equals(this.voicetrack.urls(),f))return this.voicetrack=new Howl({urls:f,loop:!1,buffer:!0,volume:0}),null!=this.soundtrack&&this.soundtrack.fade(this.soundtrack.volume(),a.volume/2),this.voicetrack.play(function(){return g.voicetrack.fade(0,a.volume,2e3)})}else if(null!=this.voicetrack)return null!=this.soundtrack&&this.soundtrack.fade(this.soundtrack.volume(),a.volume),this.voicetrack.fade(this.voicetrack.volume(),0,2e3,function(){return g.voicetrack.stop()})},d.prototype.updateVolume=function(a){if(null!=a)switch(!0){case null!=this.voicetrack&&null!=this.soundtrack:return this.voicetrack.volume(a),this.soundtrack.volume(a/2);case null!=this.voicetrack:return this.voicetrack.volume(a);case null!=this.soundtrack:return this.soundtrack.volume(a)}},d}())}]),angular.module("spin.service").factory("User",["Plot","localStorageService","$rootScope",function(a,b,c){var d;return new(d=function(){function d(){this.nextSequence=__bind(this.nextSequence,this),this.updateLocalStorage=__bind(this.updateLocalStorage,this);var a,d=this;return a=b.get("user")||{},this.token=a.token||null,this.email=a.email||null,this.volume=a.volume||.5,this.chapter=1,this.scene=1,this.sequence=0,this.ubm=~~(100*Math.random()),this.trust=~~(100*Math.random()),this.stress=~~(100*Math.random()),c.$watch(function(){return d},this.updateLocalStorage,!0),this}return d.prototype.updateLocalStorage=function(a){return null==a&&(a=this),null!=a?b.set("user",a):void 0},d.prototype.nextSequence=function(){return null!=a.sequence(this.chapter,this.scene,this.sequence+1)?++this.sequence:null!=a.scene(this.chapter,this.scene+1)?(this.sequence=0,++this.scene):null!=a.chapter(this.chapter+1)?(this.sequence=0,this.scene=a.chapter(this.chapter+1).scene[0].id,++this.chapter):void 0},d}())}]);