<div class="chapter chapter-entrance-animation ng-hide" ng-controller="ChapterCtrl" ng-show="shouldShowChapter(chapter) && user.inGame" ng-class="chapterClasses(chapter)">    

    <div class="chapter__intro" ng-show="user.isStartingChapter()">
        <div class="chapter__intro__id">Chapitre [[chapter.id]]</div>
        <h2 class="chapter__intro__title">[[chapter.title]]</h2>  
    </div>

    <div class="chapter__track" ng-hide="user.isStartingChapter()">
        <div class="chapter__track__id">Chapitre <b>[[chapter.id]]</b> / 4</div>
        <div class="chapter__track__bullets">
            <i class="chapter__track__bullets__bullet" ng-repeat="i in [] | range: 4" ng-class="{ active: i <= chapter.id - 1 }"></i>
        </div>
        <div class="chapter__track__progression">
            [[(chapter.id-1)/4*100]]<small>%</small>
        </div>
        <h2 class="chapter__track__title">[[chapter.title]]</h2>  
    </div>
    
    
    <ul class="chapter__cmd list-unstyled" ng-hide="user.isStartingChapter()">
        <li class="chapter__cmd__indicator chapter__cmd__indicator--ubm">
            <abbr class="chapter__cmd__indicator__help">
                ?
                <span class="chapter__cmd__indicator__help__definition">Unité de Bruit Médiatique : présence de votre crise dans les médias</span>
            </abbr>
            <span class="chapter__cmd__indicator__label">UBM</span>
            <span class="chapter__cmd__indicator__value">[[user.ubm]]%</span>
            <span class="chapter__cmd__indicator__progress progress">
                <span class="progress-bar progress-bar-danger" ng-style="{ width: user.ubm + '%' }">
                </span>                
            </span>
        </li>
        <li class="chapter__cmd__indicator chapter__cmd__indicator--trust">
            <abbr class="chapter__cmd__indicator__help">
                ?
                <span class="chapter__cmd__indicator__help__definition">Confiance accordée à Louis par le spin doctor</span>
            </abbr>
            <span class="chapter__cmd__indicator__label">Confiance</span>

            <span class="chapter__cmd__indicator__value">[[user.trust]]%</span>
            <span class="chapter__cmd__indicator__progress progress">
                <span class="progress-bar progress-bar-info" ng-style="{ width: user.trust + '%' }">
                </span>                
            </span>
        </li>
        <li class="chapter__cmd__indicator chapter__cmd__indicator--stress">
            <abbr class="chapter__cmd__indicator__help">
                ?
                <span class="chapter__cmd__indicator__help__definition">État émotionnel de Louis</span>
            </abbr>
            <span class="chapter__cmd__indicator__label">Stress</span>
            <span class="chapter__cmd__indicator__value">[[user.stress]]%</span>
            <span class="chapter__cmd__indicator__progress progress">
                <span class="progress-bar progress-bar-success" ng-style="{ width: user.stress + '%' }">
                </span>                
            </span>
        </li>
    </ul>



    <div ng-repeat="scene in chapter.scenes">
        <div class="scene" ng-controller="SceneCtrl" ng-show="shouldShowScene(scene)">              
            <!-- This is the main illustration -->      
            <img class="scene__bg" ng-src="[[scene.decor[0].background]]" /> 
              
            <!-- Scene's sequence -->
            <div ng-repeat="sequence in scene.sequence" 
                 class="scene__sequence scene__sequence--[[sequence.type]]"
                 ng-show="shouldShowSequence($index) && !user.isStartingChapter()">

                <!-- Dialog box, a the bottom of the screen -->
                <div ng-if="isDialog(sequence)">
                    <pre>[[sequence|json]]</pre>
                    <a class="scene__sequence--dialogue__next btn btn-default" ng-show="shouldShowNext($parent.sequence)" ng-click="goToNextSequence()">
                        <span class="sr-only">Continuer</span>
                    </a>
                </div>

                <!-- Choice box, at the middle of the screen -->
                <div ng-if="isChoice(sequence)">
                    <h3 class="scene__sequence--choice__question">
                        [[sequence.body]]
                    </h3>
                    <button ng-repeat="option in sequence.options"
                            class="btn btn-lg btn-default scene__sequence--choice__option" 
                            ng-click="selectOption(option)">
                        [[option.header]]
                    </button>
                </div>
            </div>   
        </div>
    </div> 

</div>
